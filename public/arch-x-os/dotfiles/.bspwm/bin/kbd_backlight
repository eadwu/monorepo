#!/usr/bin/env bash

# USAGE:
#   su root && \
#     echo "${USER} ALL=(ALL) NOPASSWD: ${PATH}/bin/kbd_backlight" >> /etc/sudoers.d/grant-client-overrides && \
#     exit && \
#   sudo ${PATH}/bin/kbd_backlight tick {-|+}

kl_smc=/sys/class/leds/smc::kbd_backlight
steps=15

tick=${1}

case $2 in
  -)
    new=$(( $(cat ${kl_smc}/brightness) - $(cat ${kl_smc}/max_brightness) / ( ${steps} * ${tick} ) ))
    if (( ${new} < 0 )); then
      echo "0" | tee ${kl_smc}/brightness
      exit 1
    fi
    ;;
  +)
    new=$(( $(cat ${kl_smc}/brightness) + $(cat ${kl_smc}/max_brightness) / ( ${steps} * ${tick} ) ))
    if (( ${new} > $(cat ${kl_smc}/max_brightness) )); then
      echo "$(cat ${kl_smc}/max_brightness)" | tee ${kl_smc}/brightness
      exit 1
    fi
    ;;
esac

echo "${new}" | tee ${kl_smc}/brightness
