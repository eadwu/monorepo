#!/usr/bin/env bash

# USAGE:
#   su root && \
#     echo "${USER} ALL=(ALL) NOPASSWD: ${PATH}/bin/mon_backlight" >> /etc/sudoers.d/grant-client-overrides && \
#     exit && \
#   sudo ${PATH}/bin/mon_backlight tick {-|+}

bl_intel=/sys/class/backlight/intel_backlight
steps=15

tick=${1}

case $2 in
  -)
    new=$(( $(cat ${bl_intel}/brightness) - $(cat ${bl_intel}/max_brightness) / ( ${steps} * ${tick} ) ))
    if (( ${new} < 0 )); then
      echo "0" | tee ${bl_intel}/brightness
      exit 1
    fi
    ;;
  +)
    new=$(( $(cat ${bl_intel}/brightness) + $(cat ${bl_intel}/max_brightness) / ( ${steps} * ${tick} ) ))
    if (( ${new} > $(cat ${bl_intel}/max_brightness) )); then
      echo "$(cat ${bl_intel}/max_brightness)" | tee ${bl_intel}/brightness
      exit 1
    fi
    ;;
esac

echo "${new}" | tee ${bl_intel}/brightness
